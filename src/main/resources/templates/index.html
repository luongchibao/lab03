<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω sinh vi√™n</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

<h3>DANH S√ÅCH SINH VI√äN</h3>

<input type="number" id="searchId" class="form-control mb-3"
       placeholder="T√¨m theo ID..." onkeyup="searchById()">

<table class="table table-bordered">
    <thead>
    <tr>
        <th>ID</th>
        <th>T√™n</th>
        <th>Tu·ªïi</th>
        <th>Email</th>
        <th>H√†nh ƒë·ªông</th>
    </tr>
    </thead>
    <tbody id="studentTable"></tbody>
</table>

<h4>Th√™m / C·∫≠p nh·∫≠t sinh vi√™n</h4>
<input id="id" class="form-control mb-2" placeholder="ID">
<input id="name" class="form-control mb-2" placeholder="T√™n">
<input id="age" class="form-control mb-2" placeholder="Tu·ªïi">
<input id="email" class="form-control mb-2" placeholder="Email">

<button type="button" class="btn btn-primary" onclick="addStudent()">Th√™m</button>
<button type="button" class="btn btn-warning" onclick="updateStudent()">C·∫≠p nh·∫≠t</button>

<script>
const API = "http://localhost:8080/api/students";

// GET ALL
function loadStudents() {
    fetch(API)
        .then(res => res.json())
        .then(data => renderTable(data));
}

// TH√äM
function addStudent() {
    const student = getFormData();
    fetch(API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(student)
    }).then(loadStudents);
}

// C·∫¨P NH·∫¨T
function updateStudent() {
    const student = getFormData();
    fetch(`${API}/update/${student.id}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(student)
    }).then(loadStudents);
}

// X√ìA
function deleteStudent(id) {
    fetch(`${API}/delete/${id}`, { method: "POST" })
        .then(loadStudents);
}

// üîç T√åM KI·∫æM THEO ID (Y√äU C·∫¶U 10)
function searchById() {
    const id = document.getElementById("searchId").value;

    if (id === "") {
        loadStudents();
        return;
    }

    fetch(`${API}/${id}`)
        .then(res => {
            if (!res.ok) {
                document.getElementById("studentTable").innerHTML = "";
                return;
            }
            return res.json();
        })
        .then(s => {
            if (!s) return;

            const html = `
            <tr>
                <td>${s.id}</td>
                <td>${s.name}</td>
                <td>${s.age}</td>
                <td>${s.email}</td>
                <td>
                    <button class="btn btn-danger btn-sm"
                        onclick="deleteStudent(${s.id})">X√≥a</button>
                </td>
            </tr>`;
            document.getElementById("studentTable").innerHTML = html;
        });
}

function renderTable(data) {
    let html = "";
    data.forEach(s => {
        html += `
        <tr>
            <td>${s.id}</td>
            <td>${s.name}</td>
            <td>${s.age}</td>
            <td>${s.email}</td>
            <td>
                <button class="btn btn-danger btn-sm"
                    onclick="deleteStudent(${s.id})">X√≥a</button>
            </td>
        </tr>`;
    });
    document.getElementById("studentTable").innerHTML = html;
}

function getFormData() {
    return {
        id: document.getElementById("id").value,
        name: document.getElementById("name").value,
        age: document.getElementById("age").value,
        email: document.getElementById("email").value
    };
}

loadStudents();
</script>

</body>
</html>
